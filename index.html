<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</title>

  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#1f5eff" />

  <style>
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;background:#f5f7fb}
    .hero{background:radial-gradient(circle at 20% 20%, rgba(255,255,255,.15), transparent 35%),
                      radial-gradient(circle at 80% 30%, rgba(255,255,255,.12), transparent 40%),
                      linear-gradient(135deg,#1f5eff,#2b7cff);
          color:#fff;padding:34px 20px}
    .wrap{max-width:1100px;margin:0 auto}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .leftlink{color:#fff;text-decoration:none;font-weight:800;opacity:.95}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{border:0;border-radius:14px;padding:10px 14px;font-weight:800;cursor:pointer}
    .btn-ghost{background:rgba(255,255,255,.14);color:#fff;backdrop-filter: blur(8px)}
    .btn-ghost:hover{background:rgba(255,255,255,.18)}
    .btn-danger{background:#ff4d4f;color:#fff}
    .btn-danger:hover{filter:brightness(.95)}
    .title{font-size:46px;font-weight:900;margin:18px 0 8px;letter-spacing:.02em}
    .sub{opacity:.92}
    .card{max-width:1100px;margin:-22px auto 24px;background:#fff;border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:18px 18px 10px}
    .h2{font-size:22px;font-weight:900;margin:6px 0 2px}
    .desc{color:#64748b;font-size:13px;margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .tile{display:flex;gap:12px;align-items:flex-start;border:1px solid #eef2ff;border-radius:16px;padding:14px;text-decoration:none;color:#0f172a}
    .tile:hover{border-color:#c7d2fe;box-shadow:0 8px 18px rgba(31,94,255,.10)}
    .icon{width:44px;height:44px;border-radius:14px;background:#eef2ff;display:flex;align-items:center;justify-content:center;font-size:20px}
    .t-title{font-weight:900}
    .t-sub{color:#64748b;font-size:13px;margin-top:4px}
    .foot{padding:0 20px 26px;max-width:1100px;margin:0 auto;color:#94a3b8;font-size:12px}
  </style>
</head>

<body>
  <div class="hero">
    <div class="wrap">
      <div class="topbar">
        <a class="leftlink" href="#">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼</a>

        <div class="actions">
          <button class="btn btn-ghost" id="btnAccount">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
          <button class="btn btn-danger" id="btnLogout">â» Logout</button>
        </div>
      </div>

      <div class="title">3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</div>
      <div class="sub">æˆæ¥­å†…å®¹ã‚’ã€Œ3è¡Œã€ã§æŒ¯ã‚Šè¿”ã‚‹å­¦ç¿’æ”¯æ´ã‚¢ãƒ—ãƒª</div>
    </div>
  </div>

  <div class="card">
    <div class="h2">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <p class="desc">ä½¿ã„ãŸã„æ©Ÿèƒ½ã‚’é¸ã‚“ã§ãã ã•ã„</p>

    <div class="grid">
      <a class="tile" href="/posts">
        <div class="icon">ğŸ“</div>
        <div>
          <div class="t-title">3è¡ŒæŠ•ç¨¿</div>
          <div class="t-sub">æˆæ¥­ã®è¦ç‚¹ã‚’3è¡Œã§æŠ•ç¨¿ã€‚å…ˆç”Ÿã®ã€Œã„ã„ã­ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚‚ç¢ºèªã§ãã¾ã™ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/questions">
        <div class="icon">ğŸ’¬</div>
        <div>
          <div class="t-title">è³ªå•æ²ç¤ºæ¿</div>
          <div class="t-sub">æˆæ¥­ä¸­ãƒ»å¾Œã®ç–‘å•ã‚’æŠ•ç¨¿ã€‚å­¦ç”Ÿ/æ•™å“¡ãŒå›ç­”ã—ã¦å­¦ã³åˆã„ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/quizzes">
        <div class="icon">ğŸ§ </div>
        <div>
          <div class="t-title">ã‚¯ã‚¤ã‚º</div>
          <div class="t-sub">æŠ•ç¨¿å†…å®¹ã‹ã‚‰ã€Œæ€ã„å‡ºã—ã‚¯ã‚¤ã‚ºã€ã‚’è¡¨ç¤ºã€‚å¾©ç¿’ã«ä½¿ãˆã¾ã™ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/reminders">
        <div class="icon">â°</div>
        <div>
          <div class="t-title">å¾©ç¿’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</div>
          <div class="t-sub">æˆæ¥­å¾Œã®å¾©ç¿’ã‚’ç¿’æ…£åŒ–ã€‚æœŸé™ãŒæ¥ãŸå†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/ranking">
        <div class="icon">ğŸ†</div>
        <div>
          <div class="t-title">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
          <div class="t-sub">æŠ•ç¨¿ãƒ»å›ç­”ãªã©ã®è²¢çŒ®åº¦ã‚’è¡¨ç¤ºï¼ˆè¨­å®šã§éè¡¨ç¤ºã«ã‚‚ã§ãã¾ã™ï¼‰ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/settings">
        <div class="icon">âš™ï¸</div>
        <div>
          <div class="t-title">è¨­å®š</div>
          <div class="t-sub">è¡¨ç¤ºã‚„å‹•ä½œã®è¨­å®šï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°éè¡¨ç¤ºãªã©ï¼‰ã€‚</div>
        </div>
      </a>
    </div>
  </div>

  <div class="foot" id="foot"></div>

  <script>
    async function api(path, opts = {}) {
      const res = await fetch(path, {
        ...opts,
        credentials: "include",
        cache: "no-store",
        headers: { "Content-Type": "application/json", ...(opts.headers || {}) },
      });
      let data = null;
      try { data = await res.json(); } catch (_) {}
      return { res, data };
    }

    function toLogin() {
      const next = encodeURIComponent("/index.html");
      location.replace("/login.html?next=" + next);
    }

    async function initAuth() {
      const r = await api("/api/auth/me");
      const user = r.data && r.data.user ? r.data.user : null;

      if (!user) {
        toLogin();
        return;
      }

      // å³ä¸Šè§’æ˜¾ç¤ºå½“å‰è´¦å·
      const btn = document.getElementById("btnAccount");
      btn.textContent = `ğŸ‘¤ ${user.display_name} (${user.role})`;
      btn.onclick = () => location.href = "/account";

      document.getElementById("foot").textContent =
        `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${user.display_name} / ${user.username} / role=${user.role}`;
    }

    document.getElementById("btnLogout").addEventListener("click", async () => {
      const r = await api("/api/auth/logout", { method: "POST" });
      // ä¸ç®¡è¿”å›ä»€ä¹ˆï¼Œéƒ½å¼ºåˆ¶å›åˆ°ç™»å½•é¡µï¼ˆé¿å…ç¼“å­˜å¹²æ‰°ï¼‰
      location.replace("/login.html?v=" + Date.now());
    });

    // å¯åŠ¨
    initAuth();
  </script>
</body>
</html>
