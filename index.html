<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;background:#f4f7fb;color:#111}
    .hero{background:linear-gradient(90deg,#1f6feb,#2f81f7);color:#fff;padding:48px 0 36px}
    .wrap{max-width:1100px;margin:0 auto;padding:0 24px}
    .topbar{display:flex;align-items:center;justify-content:space-between}
    .title{font-size:48px;font-weight:800;letter-spacing:1px;margin:24px 0 8px}
    .subtitle{opacity:.9;margin:0 0 18px}
    .rightnav{display:flex;gap:10px;align-items:center}
    .btn{border:0;border-radius:14px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btnGhost{background:rgba(255,255,255,.15);color:#fff}
    .btnDanger{background:#ff4d4f;color:#fff}
    .card{background:#fff;border-radius:18px;box-shadow:0 12px 30px rgba(16,24,40,.08);padding:28px;margin:26px auto}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    .item{display:flex;gap:14px;align-items:flex-start;border:1px solid #e6edf5;border-radius:16px;padding:18px 16px;background:#fff;cursor:pointer;text-decoration:none;color:#111}
    .item:hover{box-shadow:0 8px 18px rgba(16,24,40,.08)}
    .ico{width:44px;height:44px;border-radius:14px;background:#eef5ff;display:flex;align-items:center;justify-content:center}
    .itTitle{font-size:18px;font-weight:800;margin:2px 0 6px}
    .itText{margin:0;color:#556;line-height:1.55}
    .muted{color:#667; font-size:14px; margin:0}
    @media (max-width:860px){.grid{grid-template-columns:1fr}.title{font-size:36px}}
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <div class="topbar">
        <div class="muted">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
        <div class="rightnav">
          <span id="loginInfo" style="margin-right:12px; opacity:.9; font-size:14px;"></span>
          <a class="btn btnGhost" href="/account.html" style="text-decoration:none;">
            <span>ğŸ‘¤</span><span>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</span>
          </a>
          <button id="logoutBtn" class="btn btnDanger">â›” Logout</button>
        </div>
      </div>
      <h1 class="title">3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h1>
      <p class="subtitle">æˆæ¥­å†…å®¹ã‚’ã€Œ3è¡Œã€ã§æŒ¯ã‚Šè¿”ã‚‹å­¦ç¿’æ”¯æ´ã‚¢ãƒ—ãƒª</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2 style="margin:0 0 6px;font-size:24px;font-weight:900">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
      <p class="muted" style="margin:0 0 18px">ä½¿ã„ãŸã„æ©Ÿèƒ½ã‚’é¸ã‚“ã§ãã ã•ã„</p>

      <div class="grid">
        <a class="item" href="/posts.html">
          <div class="ico">ğŸ“</div>
          <div>
            <div class="itTitle">3è¡ŒæŠ•ç¨¿</div>
            <p class="itText">æˆæ¥­ã®è¦ç‚¹ã‚’3è¡Œã§æŠ•ç¨¿ã€‚å…ˆç”Ÿã®ã€Œã„ã„ã­ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚‚ç¢ºèªã§ãã¾ã™ã€‚</p>
          </div>
        </a>

        <a class="item" href="/questions.html">
          <div class="ico">ğŸ’¬</div>
          <div>
            <div class="itTitle">è³ªå•æ²ç¤ºæ¿</div>
            <p class="itText">æˆæ¥­ä¸­ãƒ»å¾Œã®ç–‘å•ã‚’æŠ•ç¨¿ã€‚å­¦ç”Ÿï¼æ•™å“¡ãŒå›ç­”ã—ã¦å­¦ã³åˆã„ã€‚</p>
          </div>
        </a>

        <a class="item" href="/quizzes.html">
          <div class="ico">ğŸ§ </div>
          <div>
            <div class="itTitle">ã‚¯ã‚¤ã‚º</div>
            <p class="itText">æŠ•ç¨¿å†…å®¹ã‹ã‚‰ã€Œæ€ã„å‡ºã—ã‚¯ã‚¤ã‚ºã€ã‚’è¡¨ç¤ºã€‚å¾©ç¿’ã«ä½¿ãˆã¾ã™ã€‚</p>
          </div>
        </a>

        <a class="item" href="/reminders.html">
          <div class="ico">â°</div>
          <div>
            <div class="itTitle">å¾©ç¿’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</div>
            <p class="itText">æˆæ¥­å¾Œã®å¾©ç¿’ã‚’ç¿’æ…£åŒ–ã€‚æœŸé™ãŒæ¥ãŸå†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
          </div>
        </a>
      </div>
    </section>
  </main>

  <script>
    function qs(id){ return document.getElementById(id); }

    async function apiGet(path){
      const r = await fetch(path, {
        method: "GET",
        credentials: "include",
        cache: "no-store"
      });
      return { ok: r.ok, status: r.status, data: await r.json().catch(()=>null) };
    }

    async function apiPost(path, body){
      const r = await fetch(path, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        cache: "no-store",
        body: body ? JSON.stringify(body) : null
      });
      let data = null;
      try { data = await r.json(); } catch {}
      return { ok: r.ok, status: r.status, data };
    }

    function toLogin(){
      location.replace("/login?ts=" + Date.now());
    }

    async function ensureAuth(){
      // ç”±äºåˆšç™»å½•å®Œæˆç«‹åˆ»è·³è½¬æ—¶ï¼Œæå°‘æ•°æƒ…å†µä¸‹ cookie å†™å…¥ä¸å¯¼èˆªç«äº‰ï¼Œ
      // æˆ‘ä»¬åšä¸€æ¬¡è½»é‡é‡è¯•ï¼Œé¿å…è¯¯åˆ¤â€œæœªç™»å½•â€é€ æˆå¾ªç¯ã€‚
      let me = await apiGet("/api/auth/me");
      if (me.ok && me.data && me.data.ok && me.data.user) return me.data.user;

      await new Promise(r => setTimeout(r, 150));
      me = await apiGet("/api/auth/me");
      if (me.ok && me.data && me.data.ok && me.data.user) return me.data.user;

      return null;
    }

    async function boot(){
      const user = await ensureAuth();
      if (!user) return toLogin();

      qs("loginInfo").textContent = `å·²ç™»å½•ï¼š${user.display_name} (${user.role})`;

      qs("logoutBtn").addEventListener("click", async () => {
        const res = await apiPost("/api/auth/logout");
        // ä¸ç®¡åç«¯è¿”å›ä»€ä¹ˆï¼Œéƒ½å¼ºåˆ¶å›ç™»å½•é¡µå¹¶å¸¦ ts é¿å…ç¼“å­˜
        toLogin();
      });
    }

    boot();
  </script>
</body>
</html>
