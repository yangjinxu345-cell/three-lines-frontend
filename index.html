<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --brand: #0051c3;
      --bg: #f7f7f7;
      --card: #ffffff;
      --text: #111;
      --muted: #666;
      --border: #e5e7eb;
      --danger: #d93025;
      --ok: #188038;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      margin: 0;
      color: var(--text);
    }
    header {
      background: var(--brand);
      color: #fff;
      padding: 18px 16px;
      text-align: center;
    }
    header h1 { margin: 0 0 6px; font-size: 28px; }
    header p { margin: 0; opacity: .95; }

    main {
      max-width: 980px;
      margin: 22px auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 880px) {
      main { grid-template-columns: 1.2fr .8fr; }
    }

    .card {
      background: var(--card);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      padding: 18px;
    }
    h2 { margin: 0 0 12px; font-size: 20px; }
    p { line-height: 1.6; }

    label { display: block; font-weight: 600; margin: 10px 0 6px; }
    input[type="text"], textarea, select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 14px;
      background: #fff;
    }
    textarea { min-height: 44px; resize: vertical; }

    .row { display: grid; gap: 12px; }
    @media (min-width: 640px) {
      .row.two { grid-template-columns: 1fr 1fr; }
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
      align-items: center;
    }
    button {
      border: 0;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
    }
    .primary { background: var(--brand); color: #fff; }
    .ghost { background: #eef3ff; color: #083a87; }
    .danger { background: #ffe9e7; color: var(--danger); }

    .hint { color: var(--muted); font-size: 13px; margin-top: 6px; }
    .msg { font-size: 13px; margin-left: auto; }
    .msg.ok { color: var(--ok); }
    .msg.err { color: var(--danger); }

    .post {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
      background: #fff;
    }
    .post .meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .post .lines { margin: 0; padding-left: 18px; }
    .post .lines li { margin: 4px 0; }

    .toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 10px;
    }
    .pill {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: #fafafa;
    }

    footer {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      margin: 22px 0 26px;
    }
    code { background: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>

<body>
  <header>
    <h1>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h1>
    <p>æˆæ¥­å†…å®¹ã‚’ã€Œ3è¡Œã€ã§æŒ¯ã‚Šè¿”ã‚‹å­¦ç¿’æ”¯æ´ã‚¢ãƒ—ãƒª</p>
  </header>

  <main>
    <!-- å·¦ï¼šæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <section class="card">
      <h2>3è¡Œã¾ã¨ã‚æŠ•ç¨¿</h2>

      <div class="row two">
        <div>
          <label for="student">åå‰ï¼ˆä»®ï¼‰</label>
          <select id="student">
            <option value="æ¥Šæ—»">æ¥Šæ—»</option>
            <option value="é–€ç”°">é–€ç”°</option>
            <option value="é•·å²¡">é•·å²¡</option>
            <option value="ç¥å°¾">ç¥å°¾</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
          <div class="hint">â€» å¾Œã§ã€Œå…¨å“¡åç°¿ã‹ã‚‰é¸æŠã€æ–¹å¼ã«ã‚‚å¤‰æ›´ã§ãã¾ã™ã€‚</div>
        </div>

        <div>
          <label for="lesson">æˆæ¥­å / ãƒ†ãƒ¼ãƒ</label>
          <input id="lesson" type="text" placeholder="ä¾‹ï¼‰SQLï¼šå¤–éƒ¨çµåˆ / Javaï¼šç¶™æ‰¿" />
          <div class="hint">â€» å¾Œã§ã€Œæˆæ¥­ã”ã¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®šã€ã«ç™ºå±•ã•ã›ã¾ã™ã€‚</div>
        </div>
      </div>

      <label for="line1">1è¡Œç›®</label>
      <textarea id="line1" maxlength="80" placeholder="ä»Šæ—¥ã®ãƒã‚¤ãƒ³ãƒˆâ‘ ï¼ˆ80æ–‡å­—ã¾ã§ï¼‰"></textarea>

      <label for="line2">2è¡Œç›®</label>
      <textarea id="line2" maxlength="80" placeholder="ä»Šæ—¥ã®ãƒã‚¤ãƒ³ãƒˆâ‘¡ï¼ˆ80æ–‡å­—ã¾ã§ï¼‰"></textarea>

      <label for="line3">3è¡Œç›®</label>
      <textarea id="line3" maxlength="80" placeholder="ä»Šæ—¥ã®ãƒã‚¤ãƒ³ãƒˆâ‘¢ï¼ˆ80æ–‡å­—ã¾ã§ï¼‰"></textarea>

      <div class="actions">
        <button class="primary" id="btnPost">æŠ•ç¨¿ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</button>
        <button class="ghost" id="btnFill">ä¾‹ã‚’è‡ªå‹•å…¥åŠ›</button>
        <button class="danger" id="btnClear">ã‚¯ãƒªã‚¢</button>
        <div id="msg" class="msg"></div>
      </div>

      <div class="hint">
        ä»Šã¯ã€Œãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼‰ã€ã§å‹•ä½œç¢ºèªã—ã¾ã™ã€‚<br/>
        æ¬¡ã®æ®µéšã§ <code>Cloudflare Workers</code> ã® API ã«æ¥ç¶šã—ã€<code>D1</code> ã«ä¿å­˜ã—ã¾ã™ã€‚
      </div>
    </section>

    <!-- å³ï¼šä¸€è¦§ -->
    <aside class="card">
      <h2>ã¿ã‚“ãªã®æŠ•ç¨¿ï¼ˆä»®ï¼‰</h2>
      <div class="toolbar">
        <span class="pill">ä¿å­˜å…ˆï¼šã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰</span>
        <span class="pill" id="countPill">0 ä»¶</span>
      </div>
      <div id="posts"></div>
      <div class="hint">
        â€» â€œã„ã„ã­ / ã‚³ãƒ¡ãƒ³ãƒˆ / åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰â€ ã¯å¾Œã§è¿½åŠ ã—ã¾ã™ã€‚
      </div>
    </aside>
  </main>

  <footer>
    Â© 2025 3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆCloudflare Pagesï¼‰
  </footer>

  <script>
    // ===== è¨­å®šï¼ˆå¾Œã§ã“ã“ã‚’ Workers API ã«å·®ã—æ›¿ãˆã‚‹ï¼‰=====
    // const API_BASE = "https://your-worker.your-subdomain.workers.dev";

    const STORAGE_KEY = "three_lines_posts_v1";

    const $ = (id) => document.getElementById(id);

    function nowJSTString() {
      // ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚åˆ»ã‚’ãã®ã¾ã¾è¡¨ç¤ºï¼ˆæ—¥æœ¬æ™‚é–“PCãªã‚‰JSTï¼‰
      const d = new Date();
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function loadPosts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const posts = raw ? JSON.parse(raw) : [];
        return Array.isArray(posts) ? posts : [];
      } catch {
        return [];
      }
    }

    function savePosts(posts) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
    }

    function setMessage(text, type) {
      const el = $("msg");
      el.textContent = text || "";
      el.className = "msg" + (type ? ` ${type}` : "");
      if (text) {
        // 3ç§’ã§æ¶ˆãˆã‚‹
        setTimeout(() => {
          if (el.textContent === text) el.textContent = "";
        }, 3000);
      }
    }

    function validateInput(student, lesson, l1, l2, l3) {
      if (!student) return "åå‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚";
      if (!lesson.trim()) return "æˆæ¥­å / ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      const lines = [l1, l2, l3].map(s => s.trim());
      if (lines.some(s => !s)) return "1ï½3è¡Œç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      return null;
    }

    function render() {
      const posts = loadPosts().sort((a,b) => b.createdAt - a.createdAt);
      $("countPill").textContent = `${posts.length} ä»¶`;

      const container = $("posts");
      container.innerHTML = "";

      if (posts.length === 0) {
        container.innerHTML = `<p class="hint">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å·¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æŠ•ç¨¿ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>`;
        return;
      }

      for (const p of posts) {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <div class="meta">
            <span>ğŸ§‘ ${escapeHtml(p.student)}</span>
            <span>ğŸ“˜ ${escapeHtml(p.lesson)}</span>
            <span>ğŸ•’ ${escapeHtml(p.createdAtText)}</span>
          </div>
          <ol class="lines">
            <li>${escapeHtml(p.line1)}</li>
            <li>${escapeHtml(p.line2)}</li>
            <li>${escapeHtml(p.line3)}</li>
          </ol>
        `;
        container.appendChild(div);
      }
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function clearForm() {
      $("lesson").value = "";
      $("line1").value = "";
      $("line2").value = "";
      $("line3").value = "";
      $("lesson").focus();
    }

    $("btnPost").addEventListener("click", () => {
      const student = $("student").value;
      const lesson = $("lesson").value;
      const line1 = $("line1").value;
      const line2 = $("line2").value;
      const line3 = $("line3").value;

      const err = validateInput(student, lesson, line1, line2, line3);
      if (err) {
        setMessage(err, "err");
        return;
      }

      const posts = loadPosts();
      const post = {
        id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
        student,
        lesson: lesson.trim(),
        line1: line1.trim(),
        line2: line2.trim(),
        line3: line3.trim(),
        createdAt: Date.now(),
        createdAtText: nowJSTString(),
      };
      posts.push(post);
      savePosts(posts);

      setMessage("æŠ•ç¨¿ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰âœ…", "ok");
      clearForm();
      render();
    });

    $("btnFill").addEventListener("click", () => {
      $("lesson").value = "SQLï¼šå¤–éƒ¨çµåˆï¼ˆLEFT JOINï¼‰";
      $("line1").value = "FROMã«æ›¸ã„ãŸè¡¨ã§ã‚‚ã€å¤–éƒ¨çµåˆã¯æ—§å¼è¨˜æ³•ã ã¨è¡¨ç¾ãŒé›£ã—ã„ã€‚";
      $("line2").value = "LEFT JOINã¯å·¦è¡¨ã‚’å…¨ä»¶æ®‹ã—ã€å³è¡¨ãŒç„¡ã‘ã‚Œã°NULLã«ãªã‚‹ã€‚";
      $("line3").value = "æ¡ä»¶ã‚’æ›¸ãå ´æ‰€ï¼ˆON / WHEREï¼‰ã§çµæœãŒå¤‰ã‚ã‚‹ã®ã§æ³¨æ„ã€‚";
      setMessage("ä¾‹ã‚’å…¥åŠ›ã—ã¾ã—ãŸã€‚å¿…è¦ãªã‚‰ç·¨é›†ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚", "ok");
    });

    $("btnClear").addEventListener("click", () => {
      clearForm();
      setMessage("å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚", "ok");
    });

    // åˆæœŸè¡¨ç¤º
    render();
  </script>
</body>
</html>
