<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</title>
  <style>
    :root{--blue:#2563eb;--blue2:#1d4ed8;--bg:#eef3ff;--card:#fff;--text:#0f172a;--muted:#64748b;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;background:var(--bg);color:var(--text);}
    header{background:linear-gradient(135deg,var(--blue),var(--blue2));color:#fff;padding:44px 28px;position:relative;overflow:hidden;}
    header:before{content:"";position:absolute;inset:-30px;opacity:.18;background:
      radial-gradient(circle at 20% 30%, #fff 0 120px, transparent 121px),
      radial-gradient(circle at 80% 20%, #fff 0 180px, transparent 181px);
    }
    header .topbar{display:flex;align-items:center;justify-content:flex-end;gap:10px;position:relative;z-index:1;}
    .btn{border:0;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer;}
    .btnGhost{background:rgba(255,255,255,.18);color:#fff;}
    .btnDanger{background:#ef4444;color:#fff;}
    header h1{margin:22px 0 8px;font-size:44px;letter-spacing:.02em;position:relative;z-index:1;}
    header p{margin:0;color:rgba(255,255,255,.9);position:relative;z-index:1;}
    main{max-width:1100px;margin:0 auto;padding:22px;}
    .wrap{background:rgba(255,255,255,.6);backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,.6);border-radius:22px;padding:18px;box-shadow:0 18px 40px rgba(2,6,23,.08);margin-top:-38px;}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;}

    .tile{display:flex;gap:14px;align-items:flex-start;background:var(--card);border:1px solid #e5e7eb;border-radius:18px;padding:16px;text-decoration:none;color:inherit;
      box-shadow:0 10px 26px rgba(2,6,23,.06);}
    .ico{width:44px;height:44px;border-radius:14px;background:#eef2ff;display:flex;align-items:center;justify-content:center;font-size:22px;flex:0 0 44px;}
    .t{font-weight:800;margin-bottom:4px}
    .d{color:var(--muted);font-size:14px;line-height:1.4}
    .meta{margin-top:10px;color:rgba(255,255,255,.9);font-size:14px;position:relative;z-index:1;}
    .hidden{display:none}

    /* ===== ã‚¯ã‚¤ã‚ºåˆ†ç»„ ===== */
    .group {
      border:2px dashed #c7d2fe;
      border-radius:20px;
      padding:14px;
      background:rgba(255,255,255,.75);
    }
    .group-title {
      font-weight:900;
      color:#3730a3;
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .group-grid {
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
  </style>
</head>
<body>

<header>
  <div class="topbar">
    <button id="btnMenu" class="btn btnGhost">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
    <button id="btnAccount" class="btn btnGhost">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
    <button id="btnLogout" class="btn btnDanger">ğŸš« Logout</button>
  </div>

  <h1>3è¡Œã‚¢ãƒ—ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h1>
  <p>æˆæ¥­å†…å®¹ã‚’ã€Œ3è¡Œã€ã§æŒ¯ã‚Šè¿”ã‚‹å­¦ç¿’æ”¯æ´ã‚¢ãƒ—ãƒª</p>
  <div id="loginMeta" class="meta hidden">
    ãƒ­ã‚°ã‚¤ãƒ³ï¼š<span id="metaName"></span>ï¼ˆ<span id="metaUser"></span>ï¼‰
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">

      <a class="tile" href="/posts.html">
        <div class="ico">ğŸ“</div>
        <div>
          <div class="t">3è¡ŒæŠ•ç¨¿</div>
          <div class="d">æˆæ¥­ã®è¦ç‚¹ã‚’3è¡Œã§æŠ•ç¨¿ã€‚å…ˆç”Ÿã®ã€Œã„ã„ã­ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚‚ç¢ºèªã§ãã¾ã™ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/questions.html">
        <div class="ico">ğŸ’¬</div>
        <div>
          <div class="t">è³ªå•æ²ç¤ºæ¿</div>
          <div class="d">æˆæ¥­ä¸­ãƒ»å¾Œã®ç–‘å•ã‚’æŠ•ç¨¿ã€‚å­¦ç”Ÿ/æ•™å“¡ãŒå›ç­”ã—ã¦å­¦ã³åˆã„ã€‚</div>
        </div>
      </a>

      <!-- ===== ã‚¯ã‚¤ã‚º åˆ†ç»„ ===== -->
      <div class="group">
        <div class="group-title">ğŸ§© ã‚¯ã‚¤ã‚º</div>
        <div class="group-grid">
          <a class="tile" href="/quiz.html">
            <div class="ico">ğŸ§©</div>
            <div>
              <div class="t">ã‚¯ã‚¤ã‚º</div>
              <div class="d">æŠ•ç¨¿å†…å®¹ã‹ã‚‰ã€Œæ€ã„å‡ºã—ã‚¯ã‚¤ã‚ºã€ã‚’è¡¨ç¤ºã€‚å¾©ç¿’ã«ä½¿ãˆã¾ã™ã€‚</div>
            </div>
          </a>

          <a id="tileQuizAdmin" class="tile hidden" href="/quiz_admin.html">
            <div class="ico">ğŸ› ï¸</div>
            <div>
              <div class="t">ã‚¯ã‚¤ã‚ºç®¡ç†</div>
              <div class="d">ã‚¯ã‚¤ã‚ºã®ç”Ÿæˆãƒ»ç·¨é›†ãƒ»å…¬é–‹ï¼ˆæ•™å“¡/ç®¡ç†è€…ã®ã¿ï¼‰ã€‚</div>
            </div>
          </a>
        </div>
      </div>

      <a class="tile" href="/reminders.html">
        <div class="ico">â°</div>
        <div>
          <div class="t">å¾©ç¿’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</div>
          <div class="d">æˆæ¥­å¾Œã®å¾©ç¿’ã‚’ç¿’æ…£åŒ–ã€‚æœŸé™ãŒæ¥ãŸå†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/ranking.html">
        <div class="ico">ğŸ†</div>
        <div>
          <div class="t">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
          <div class="d">æŠ•ç¨¿ãƒ»å›ç­”ãªã©ã®è²¢çŒ®åº¦ã‚’è¡¨ç¤ºï¼ˆè¨­å®šã§éè¡¨ç¤ºã«ã‚‚ã§ãã¾ã™ï¼‰ã€‚</div>
        </div>
      </a>

      <a class="tile" href="/settings.html">
        <div class="ico">âš™ï¸</div>
        <div>
          <div class="t">è¨­å®š</div>
          <div class="d">è¡¨ç¤ºã‚„å‹•ä½œã®è¨­å®šï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°éè¡¨ç¤ºãªã©ï¼‰ã€‚</div>
        </div>
      </a>

    </div>
  </div>
</main>

<script>
  async function apiGet(path){
    const res = await fetch(path, { credentials:"include", cache:"no-store" });
    const data = await res.json().catch(()=>null);
    return { ok: res.ok, data };
  }
  async function apiPost(path, body){
    const res = await fetch(path, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      credentials:"include",
      body:JSON.stringify(body||{})
    });
    return res;
  }
  function isTeacherOrAdmin(u){
    return u && (u.role === "admin" || u.role === "teacher");
  }

  (async ()=>{
    const r = await apiGet("/api/auth/me?ts="+Date.now());
    if (!r.ok || !r.data?.ok) {
      location.replace("/login");
      return;
    }
    const u = r.data.user;
    metaName.textContent = u.display_name || u.username;
    metaUser.textContent = u.username;
    loginMeta.classList.remove("hidden");

    if (isTeacherOrAdmin(u)) {
      document.getElementById("tileQuizAdmin").classList.remove("hidden");
    }
  })();

  btnLogout.onclick = async ()=>{
    await apiPost("/api/auth/logout",{});
    location.replace("/login");
  };
  btnAccount.onclick = ()=>location.href="/account.html";
  btnMenu.onclick = ()=>location.href="/index.html";
</script>

</body>
</html>
